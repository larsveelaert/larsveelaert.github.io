<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  
  
  <title>A transparent poor man&#39;s VPN with sshuttle (Linux)</title>
  <meta name="description" content="Why? There are a lot of reasons why you would want a proxy or VPN, one of them is safety and protection from attackers at your location. For example if you are visiting sensitive things in your local coffee shop, other visitors could sniff your traffic because they are connected to the same network. From that point it is not only possible to read but also manupulate the ftraffic and possibly inject malicious code. Other usage cases are services who are only accessible behind a firewall or only if the user appears to be located at a certain specified IP address. Most of the time, a proxy is one connection that gets rerouted while a VPN is a more client-friendly option to reroute all traffic from a system. If you do not want to configure every application to use your proxy, and want to reroute all traffic, the tool shuttle is a perfect fit. It uses SSH under the hood so the permissions are managed through your existing SSH server so no extra user management is required. I you are searching for a way to only route one command or application through a proxy have a look at an earlier article I wrote. In a lot of cases you don’t need to search the applications native capability for configuring a proxy. The more traffic you route through your ssh server, the more demanding and slow the operation becomes. So keep that in mind. Let’s begin! How to install? There are 2 things you will need; A ssh server on a remote device (there are tutorials specific to your flavour of linux) pip, the package manager from python To install the python package manager, run one of the following commands; apt-get install python-pip # for debian and others pacman -Sy python pip #for archlinux users Now we can install sshuttle; pip install sshuttle Done! How to setup? There are a lot of general options and specific routing options that can be configured with sshuttle. But this article will just explain the transparent proxy (reroute all outgoing traffic). You can find the full documentation here. Now,for example, if we had an SSH server located at 192.168.13.2 and properly configured to accept connections from our address, we could run; sshuttle --dns -vvr me@192.168.13.2:22 0/0 This will first make a connection to your ssh server and then start routing all traffic from your system to this location. As you can see from the extra option. Also your DNS-requests will be tunneled. To make sure there is not traffic leaked, look into network monitoring software like wireshark. To test launch some applications and see if there is info being leaked. Tip for experts You can make a bash function to automate the process and be able to quickly switch between servers. For this example we will use the basic sshuttle command, but any one of them will work. You can add a function to your .bashrc-file like this; proxy () { sshuttle --dns -vvr $1 0/0 } The result of this will be that you can run one of the following in your bash-prompt: $ proxy me@192.168.13.2:22 $ proxy ssh_server1 And it will proxy all your traffic to a preconfigured ssh server. To use your proxy as in the second example, you will have to configure your destination in the ~/.ssh/config file from your system to make it really useful It will even take the keys that are loaded in your SSH-agent. There is awesome documentation of this program, so make sure to check it out!">
  

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/2017/02/17/poor-man-vpn/">
  
  
  <link rel="alternate" type="application/rss+xml" title="lvlrt" href="http://localhost:4000/feed.xml">

  

  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:title" content="A transparent poor man&#39;s VPN with sshuttle (Linux)">
  <meta name="twitter:description" content="Why? There are a lot of reasons why you would want a proxy or VPN, one of them is safety and protection from attackers at your location. For example if you are visiting sensitive things in your loc...">
  
  

  <script type="text/javascript">
  WebFontConfig = {
    google: { families: [ 'Bitter:400,700,400italic:latin' ] }
  };
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
  })();
</script>

  
  <!-- Google Analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-112123975-1', 'auto');
    ga('send', 'pageview');

  </script>


</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">lvlrt</a>

    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/">About</a>
      
        
        <a class="page-link" href="/archives/">Archives</a>
      
        
        <a class="page-link" href="https://demgeeks.com">DemGeeks</a>
      
        
        <a class="page-link" href="https://github.com/larsveelaert">GitHub</a>
      
        
        <a class="page-link" href="https://linkedin.com/in/larsveelaert">LinkedIn</a>
      
    </nav>

  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    
      <h1 class="post-title" itemprop="name headline">A transparent poor man&#39;s VPN with sshuttle (Linux)</h1>
    
    <p class="post-meta"><time datetime="2017-02-17T00:00:00+00:00" itemprop="datePublished">Feb 17, 2017</time> •
  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        <a href="/categories/networking/">Networking</a>
      
    
      
    
      
    
      
    
  


 •
  
    
    
      
    
      
    
      
    
      
    
      
    
      
        <a href="/tags/anonimity/">anonimity</a>,
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        <a href="/tags/encryption/">encryption</a>,
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  
    
    
      
        <a href="/tags/linux/">linux</a>,
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  
    
    
      
    
      
    
      
    
      
        <a href="/tags/terminal/">terminal</a>,
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        <a href="/tags/vpn/">vpn</a>
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  

</p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <h2>Why?</h2>

<p>There are a lot of reasons why you would want a <a href="https://en.wikipedia.org/wiki/Proxy_server">proxy</a> or <a href="https://en.wikipedia.org/wiki/Virtual_private_network">VPN</a>, one of them is safety and protection from attackers at your location. For example if you are visiting sensitive things in your local coffee shop, other visitors could sniff your traffic because they are connected to the same network. From that point it is not only possible to read but also manupulate the ftraffic and possibly inject malicious code. Other usage cases are services who are only accessible behind a firewall or only if the user appears to be located at a certain specified IP address.</p>

<p>Most of the time, a proxy is one connection that gets rerouted while a VPN is a more client-friendly option to reroute all traffic from a system.
If you do not want to configure every application to use your proxy, and want to reroute all traffic, the tool <code class="highlighter-rouge">shuttle</code> is a perfect fit. 
It uses SSH under the hood so the permissions are managed through your existing SSH server so no extra user management is required.</p>

<p>I you are searching for a way to only route one command or application through a proxy have a look at <a href="/2017/02/02/tip-running-a-terminal-command-through-a-proxy/">an earlier article</a> I wrote. 
In a lot of cases you don’t need to search the applications native capability for configuring a proxy.
The more traffic you route through your ssh server, 
the more demanding and slow the operation becomes. So keep that in mind. Let’s begin!</p>

<h2>How to install?</h2>

<p>There are 2 things you will need;</p>

<ul>
  <li>A ssh server on a remote device (there are tutorials specific to your flavour of linux)</li>
  <li><em><a href="https://pypi.python.org/pypi/pip">pip</a></em>, the package manager from python</li>
</ul>

<p>To install the python package manager, run one of the following commands;</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt-get install python-pip # for debian and others
pacman -Sy python pip #for archlinux users
</code></pre></div></div>

<p>Now we can install <em>sshuttle</em>;</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install sshuttle
</code></pre></div></div>
<p>Done!</p>

<h3>How to setup?</h3>

<p>There are a lot of general options and specific routing options that can be configured with <code class="highlighter-rouge">sshuttle</code>.
But this article will just explain the transparent proxy (reroute all outgoing traffic). 
You can find the full documentation <a href="https://sshuttle.readthedocs.io/en/stable/overview.html">here</a>.</p>

<p>Now,for example, if we had an SSH server located at 192.168.13.2 and properly configured to accept connections from our address, we could run;</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sshuttle --dns -vvr me@192.168.13.2:22 0/0
</code></pre></div></div>
<p>This will first make a connection to your ssh server and then start routing all traffic from your system to this location.
As you can see from the extra option. Also your DNS-requests will be tunneled.</p>

<p>To make sure there is not traffic leaked, look into network monitoring software like <a href="https://www.wireshark.org/">wireshark</a>. To test launch some applications and see if there is info being leaked.</p>

<h3>Tip for experts</h3>
<p>You can make a bash function to automate the process and be able to quickly switch between servers.
For this example we will use the basic sshuttle command, but any one of them will work.</p>

<p>You can add a function to your .bashrc-file like this;</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>proxy () {
sshuttle --dns -vvr $1 0/0
}
</code></pre></div></div>

<p>The result of this will be that you can run one of the following in your bash-prompt:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ proxy me@192.168.13.2:22 
$ proxy ssh_server1
</code></pre></div></div>
<p>And it will proxy all your traffic to a preconfigured ssh server.
To use your proxy as in the second example, you will have to configure your destination in the ~/.ssh/config file from your system to make it really useful
It will even take the keys that are loaded in your SSH-agent.</p>

<p>There is awesome documentation of this program, so <a href="https://sshuttle.readthedocs.io/en/stable/overview.html">make sure to check it out</a>!</p>

  </div>

  

</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <p>
      

&copy; Lars Veelaert - Powered by <a href="https://jekyllrb.com">Jekyll</a> &amp; <a href="https://github.com/yous/whiteglass">whiteglass</a> - Subscribe via <a href="http://localhost:4000/feed.xml">RSS</a>

    </p>

  </div>

</footer>


  </body>

</html>
